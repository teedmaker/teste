<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Like for Money</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="shortcut-icon" href="./favicon.ico">
    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ=="
      crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com"><link
      rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;400;700&display=swap"
      rel="stylesheet">
  </head>
  <body>

    <div id="msg">
    </div>

    <main role="main" id="tabs">
      <div id="loading-tabs">
        <h2>
          <img src="./images/loading.gif" alt="Loading"> <br>
          <span>Aguarde...</span>
        </h2>
      </div>

      <div class="tab" id="tab-index">
        <div class="tab-content">
          <section id="index-header">
            <img
              src="./images/logo.png"
              alt="Logo"
              />
            <p>
              <strong>Olá</strong>, Bem-vindo!
            </p>
          </section>
          <section id="index-box">
            <hr
              id="index-box-line"
              />
            <button id="index-box-button" data-open-tab="login">
              <i class="fa fa-sign-out-alt"></i>
              <span>Fazer login</span>
            </button>
            <a
              href="javascript:void(0);"
              id="index-box-termos">
              Termos de uso
            </a>
          </section>
        </div>
      </div>
      <div class="tab" id="tab-login">
        <div id="tab-login-content">
          <div id="tab-login-content-top">
            <span id="tab-login-content-back" data-open-tab="index">
              <i class="fa fa-chevron-left"></i>
            </span>
            <span id="tab-login-content-title disabled">
              Log in
            </span>
          </div>
          <div id="tab-login-content-body">
            <h3 id="tab-login-content-body-title">
              Faça seu login e comece a faturar!
            </h3>
            <form id="tab-login-content-body-form">
              <div class="tab-login-content-body-input email">
                <i class="fa fa-user-circle"></i>
                <input
                  type="email"
                  placeholder="Email de compra"
                  value="josecarlosdasilva@hotmail.com"
                  />
              </div>
            </form>
          </div>
        </div>
        <div id="tab-login-footer">
          <button id="tab-login-button">
            Log in
          </button>
        </div>
      </div>
      <div class="tab contain-tab-menu" id="tab-home">
        home
      </div>
      <div class="tab contain-tab-menu" id="tab-sacar">
        <div id="tab-sacar-content">
          <section id="tab-sacar-header">
            <img
              id="tab-sacar-image"
              src="./images/profile.png"
              alt="Imagem do usuário"
              />
            <p>
              <strong>José Carlos</strong> <br>
              <span>josecarlosdasilva@hotmail.com</span>
            </p>
          </section>
          <section id="tab-sacar-saldo">
            <h5 id="tab-sacar-saldo-title">
              Seu Saldo
            </h5>
            <div id="tab-sacar-saldo-valor">
              <strong>R$</strong>
              <span>323,00</span>
            </div>
          </section>
          <section id="tab-sacar-chaves">
            <h5 id="tab-sacar-chaves-title">
              Selecione o tipo da sua chave pix:
            </h5>
            <div id="tab-sacar-chaves-content">
              <div class="tab-sacar-chaves-content active">
                <i class="fa fa-id-card"></i>
                <span>CPF/CNPJ</span>
              </div>
              <div class="tab-sacar-chaves-content">
                <i class="fa fa-mobile"></i>
                <span>Celular</span>
              </div>
              <div class="tab-sacar-chaves-content">
                <i class="fa fa-envelope"></i>
                <span>E-mail</span>
              </div>
              <div class="tab-sacar-chaves-content">
                <i class="fa fa-random"></i>
                <span>Aleatória</span>
              </div>
            </div>
          </section>
          <section id="tab-sacar-form">
            <div class="tab-sacar-form-input input-reverse">
              <i class="fa fa-user-circle"></i>
              <input
                type="text"
                id="tab-sacar-form-input-chave"
                placeholder="Selecione o tipo de chave pix"
                />
            </div>
            <div class="tab-sacar-form-input"
              id="tab-sacar-form-input-valor-container">
              <span>R$</span>
              <input
                type="text"
                id="tab-sacar-form-input-valor"
                placeholder="0,00"
                />
            </div>
            <div>
              <button id="tab-sacar-form-button-sacar">
                Sacar
              </button>
            </div>
          </section>
        </div>
      </div>

      <nav id="tab-menu">
        <ul>
          <li>
            <a href="javscript:void(0);" data-open-tab-now="home">
              <i class="fa fa-home"></i>
            </a>
          </li>
          <li class="active">
            <a href="javscript:void(0);" data-open-tab-now="sacar">
              <i class="fa fa-wallet"></i>
            </a>
          </li>
          <li>
            <a href="javscript:void(0);" id="btn-logout" data-open-tab="index">
              Sair
            </a>
          </li>
        </ul>
      </nav>
    </main>

    <script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-app.js"></script>
    <script
      src="https://www.gstatic.com/firebasejs/7.16.1/firebase-messaging.js"></script>

    <script type="module" defer>
      document.querySelectorAll('[data-open-tab]').forEach((button) => {
        button.addEventListener('click', () => {
          const tabName = button.getAttribute('data-open-tab');
          handleOpenTab(tabName);
        });
      });

      document.querySelectorAll('[data-open-tab-now]').forEach((button) => {
        button.addEventListener('click', () => {
          const tabName = button.getAttribute('data-open-tab-now');
          handleOpenTab(tabName, false);
        });
      });

      document.querySelectorAll('.tab-sacar-chaves-content').forEach((button) => {
        button.addEventListener('click', () => {
          document.querySelectorAll('.tab-sacar-chaves-content').forEach((button) => {
            button.classList.remove('active');
          });
          button.classList.add('active');
          document.querySelector('#tab-sacar-form-input-chave').value = '';
        });
      });

      document.querySelector('#tab-login-content-body-form').addEventListener('submit', (event) => {
        event.preventDefault();
        handleSubmitLogin();
      });

      document.querySelector('#tab-login-button').addEventListener('click', () => {
        handleSubmitLogin();
      });

      document.querySelector('#tab-sacar-form-button-sacar').addEventListener('click', () => {
        handleEfetuaSaque();
      });

      function checkEmailIsInvalid(email) {
        const regex = /^[\w-.]+@([\w-]+\.)+[\w-]{2,4}$/g;
        return !email || !regex.test(email);
      }

      function handleSubmitLogin() {
        const email = document.querySelector('#tab-login-content-body-form .email input').value;
        document.querySelector('#tab-login-content-body-form').classList.remove('error');
        if (checkEmailIsInvalid(email)) {
          document.querySelector('#tab-login-content-body-form').classList.add('error');
          return;
        }
        handleOpenTab('home');
      }

      function handleEfetuaSaque() {
        document.querySelector('#loading-tabs').style.display = 'flex';
        document.querySelector('#loading-tabs span').innerHTML = `Aguarde,<br/>enviando pix...`;
      }

      function handleOpenTab(tabName, loadActive = true) {
        document.querySelector('#loading-tabs').style.display = 'flex';
        document.querySelector('#loading-tabs span').innerHTML = 'Carregando...';

        setTimeout(() => {
          document.querySelector('#loading-tabs').style.display = 'none';
          const tabs = document.querySelectorAll('[role="main"] .tab');
          tabs.forEach((tab) => {
            tab.classList.remove('active');
          });
          const tab = document.querySelector(`[role="main"] #tab-${tabName}`);
          document.querySelector('#tab-menu').style.display = 'none';
          if (tab.classList.contains('contain-tab-menu')) {
            document.querySelector('#tab-menu').style.display = 'block';
            document.querySelectorAll('#tab-menu li').forEach((li) => {
              li.classList.remove('active');
            });
            document.querySelector(`#tab-menu li a[data-open-tab-now="${tabName}"]`).parentElement.classList.add('active');
          }
          tab.classList.add('active');
        }, loadActive? 500: 100);
      }

      if (!document.querySelector('.tab.active')) {
        setTimeout(() => {
          document.querySelector('#loading-tabs').style.display = 'none';
          handleOpenTab('index');
        }, 1000);
      } else {
        document.querySelector('#loading-tabs').style.display = 'none';
      }

      const firebaseConfig = {
        apiKey: "AIzaSyAYyws2NvvXfPqKRBQNoc2SifKCOA0-bQI",
        authDomain: "testeapp-aa6a6.firebaseapp.com",
        projectId: "testeapp-aa6a6",
        storageBucket: "testeapp-aa6a6.appspot.com",
        messagingSenderId: "409137549600",
        appId: "1:409137549600:web:961e1db70326d33f438745"
      };

      firebase.initializeApp(firebaseConfig);

      const messaging = firebase.messaging();
      messaging
        .requestPermission()
        .then(function () {
          return messaging.getToken()
        })
        .then(function(token) {
          // print the token on the HTML page
          localStorage.setItem('deviceToken', token);
          document.querySelector('#msg').innerHTML += '<br/>' + token;
        })
        .catch(function (err) {
          document.querySelector('#msg').innerHTML += '<br/>' + err
          console.log("Unable to get permission to notify.", err);
        });
    </script>
  </body>
</html>
